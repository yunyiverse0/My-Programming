<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>My Wishlist</title>
    <style>
        /* ê°„ë‹¨í•œ ìŠ¤íƒ€ì¼ë§ */
        .product-card { border: 1px solid #ddd; padding: 10px; margin: 10px; border-radius: 8px; }
        .category-tag { background: #eee; padding: 2px 5px; font-size: 0.8em; }
        
        /* ëª¨ë‹¬(ì„ íƒì°½) ìŠ¤íƒ€ì¼ */
        #linkModal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 15% auto; padding: 20px; width: 300px; text-align: center; border-radius: 10px; }
        .platform-btn { display: block; width: 100%; margin: 10px 0; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>ğŸ›ï¸ ë‚´ ì¥ë°”êµ¬ë‹ˆ (Wishlist)</h1>

    <form action="/" method="get">
        <select name="category">
            <option value="">ì „ì²´</option>
            <option value="ìƒì˜">ìƒì˜</option>
            <option value="í•˜ì˜">í•˜ì˜</option>
        </select>
        <input type="text" name="search" placeholder="ìƒí’ˆ ê²€ìƒ‰...">
        <button type="submit">ê²€ìƒ‰</button>
    </form>

    <div id="product-list">
        {% for product in products %}
        <div class="product-card">
            <h3>{{ product.name }} <span class="category-tag">{{ product.category }}</span></h3>
            
            <button onclick='handleBuyClick({{ product.links | tojson }})'>
                êµ¬ë§¤í•˜ëŸ¬ ê°€ê¸°
            </button>
        </div>
        {% endfor %}
    </div>

    <div id="linkModal">
        <div class="modal-content">
            <h3>ì–´ë””ì„œ êµ¬ë§¤í•˜ì‹œê² ì–´ìš”?</h3>
            <div id="modal-buttons">
                </div>
            <button onclick="closeModal()">ì·¨ì†Œ</button>
        </div>
    </div>

    <script>
        // êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” ë¡œì§
        function handleBuyClick(links) {
            if (links.length === 0) {
                alert("ë“±ë¡ëœ êµ¬ë§¤ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // 1. ë§í¬ê°€ í•˜ë‚˜ë¿ì´ë©´ ë°”ë¡œ ì´ë™ (ì˜ˆ: ìì‚¬ëª°ë§Œ ìˆì„ ë•Œ)
            if (links.length === 1) {
                window.open(links[0].buy_url, '_blank');
            } 
            // 2. ë§í¬ê°€ ì—¬ëŸ¬ ê°œë©´ ëª¨ë‹¬ì°½ ë„ìš°ê¸° (ì˜ˆ: ë¬´ì‹ ì‚¬ & ì§€ê·¸ì¬ê·¸ ë‘˜ ë‹¤ ìˆì„ ë•Œ)
            else {
                showModal(links);
            }
        }

        // ëª¨ë‹¬ ë„ìš°ê¸° í•¨ìˆ˜
        function showModal(links) {
            const modal = document.getElementById('linkModal');
            const btnContainer = document.getElementById('modal-buttons');
            
            btnContainer.innerHTML = ""; // ê¸°ì¡´ ë²„íŠ¼ ì´ˆê¸°í™”

            // ê° í”Œë«í¼ë³„ ë²„íŠ¼ ìƒì„±
            links.forEach(link => {
                const btn = document.createElement('button');
                btn.className = 'platform-btn';
                btn.innerText = link.platform_name + "ì—ì„œ ë³´ê¸°"; // ì˜ˆ: "ë¬´ì‹ ì‚¬ì—ì„œ ë³´ê¸°"
                btn.onclick = function() {
                    window.open(link.buy_url, '_blank');
                    closeModal();
                };
                btnContainer.appendChild(btn);
            });

            modal.style.display = "block";
        }

        function closeModal() {
            document.getElementById('linkModal').style.display = "none";
        }
    </script>

</body>
</html>
